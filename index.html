<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Rateio Integrado v2</title>
    
    <!-- 1. Estilos do Tailwind CSS (Layout Visual) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Bibliotecas React (Motor do Sistema) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 3. Biblioteca Excel (Leitura de Arquivos) -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>

    <!-- Estilo de Backup (Caso o Tailwind falhe) -->
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f8fafc; margin: 0; padding: 0; }
        .loading-alert { padding: 20px; background: #fff3cd; color: #856404; text-align: center; border: 1px solid #ffeeba; }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading-alert">
            Carregando sistema... Se esta mensagem não sumir em 5 segundos, verifique sua conexão com a internet.
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Ícones SVG ---
        const IconWrapper = ({ children, size = 20, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const Save = (p) => <IconWrapper {...p}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></IconWrapper>;
        const Trash2 = (p) => <IconWrapper {...p}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></IconWrapper>;
        const Plus = (p) => <IconWrapper {...p}><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></IconWrapper>;
        const BarChart3 = (p) => <IconWrapper {...p}><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></IconWrapper>;
        const Car = (p) => <IconWrapper {...p}><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><circle cx="17" cy="17" r="2"/><path d="M2 12h12"/></IconWrapper>;
        const Users = (p) => <IconWrapper {...p}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></IconWrapper>;
        const FileSpreadsheet = (p) => <IconWrapper {...p}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M8 13h2"/><path d="M8 17h2"/><path d="M14 13h2"/><path d="M14 17h2"/></IconWrapper>;
        const AlertCircle = (p) => <IconWrapper {...p}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></IconWrapper>;
        const Download = (p) => <IconWrapper {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></IconWrapper>;
        const Database = (p) => <IconWrapper {...p}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></IconWrapper>;
        const Github = (p) => <IconWrapper {...p}><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 6 6-6 10-6 10.6a3.8 3.8 0 0 0 1.9-4 1.9-4 0 0 0-2 2 0 1 .8 3 2.8 2 1.9 4 1.9 4 0 0 0-2.8.2 4.8 4.8 0 0 0-3.5-1z"/><path d="M9 22v-4c0-1.1-.9-2-2-2"/></IconWrapper>;
        const Mail = (p) => <IconWrapper {...p}><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></IconWrapper>;
        const Settings = (p) => <IconWrapper {...p}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></IconWrapper>;

        // --- Componentes ---
        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-xl shadow-sm border border-gray-100 p-6 ${className}`}>
                {children}
            </div>
        );

        // --- Funções Auxiliares ---
        const calculateDuration = (start, end) => {
            if (!start || !end) return 0;
            const [startH, startM] = start.split(':').map(Number);
            const [endH, endM] = end.split(':').map(Number);
            const startDate = new Date(0, 0, 0, startH, startM);
            const endDate = new Date(0, 0, 0, endH, endM);
            let diff = endDate - startDate;
            if (diff < 0) diff += 24 * 60 * 60 * 1000;
            return diff / (1000 * 60 * 60);
        };

        const formatHours = (decimalHours) => {
            const h = Math.floor(decimalHours);
            const m = Math.round((decimalHours - h) * 60);
            return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
        };

        function App() {
            const [activeTab, setActiveTab] = useState('controle');
            const [githubUrl, setGithubUrl] = useState('');
            const [isLoadingGithub, setIsLoadingGithub] = useState(false);
            const [showConfig, setShowConfig] = useState(false);

            // Dados
            const [costCenters, setCostCenters] = useState([]);
            const [hourBanks, setHourBanks] = useState([]);
            const [visits, setVisits] = useState([]);
            const [adminEntries, setAdminEntries] = useState([]);

            // Forms
            const [newVisit, setNewVisit] = useState({
                data: '', turma: '', cidadeOrigem: '', cidadeDestino: '',
                horarioSaida: '', horarioChegada: '', horarioInicioVisita: '', horarioFimVisita: '', supervisor: ''
            });
            const [newAdmin, setNewAdmin] = useState({
                data: '', turma: '', atividade: '', inicio: '', fim: '', supervisor: ''
            });

            // Carregar GitHub ao Iniciar
            useEffect(() => {
                const savedUrl = localStorage.getItem('rateio_github_url');
                if (savedUrl) {
                    setGithubUrl(savedUrl);
                    setTimeout(() => fetchFromGithub(savedUrl), 1000);
                }
            }, []);

            // Cálculos
            const consumptionByClass = useMemo(() => {
                const summary = {};
                hourBanks.forEach(bank => {
                    summary[bank.turma] = { total: bank.totalHoras, used: 0, details: { deslocamento: 0, visita: 0, admin: 0 } };
                });

                visits.forEach(v => {
                    if (!summary[v.turma]) return;
                    const deslocamento = calculateDuration(v.horarioSaida, v.horarioChegada);
                    const visita = calculateDuration(v.horarioInicioVisita, v.horarioFimVisita);
                    
                    if(summary[v.turma]) {
                        summary[v.turma].used += (deslocamento + visita);
                        summary[v.turma].details.deslocamento += deslocamento;
                        summary[v.turma].details.visita += visita;
                    }
                });

                adminEntries.forEach(a => {
                    if (!summary[a.turma]) return;
                    const adminTime = calculateDuration(a.inicio, a.fim);
                     if(summary[a.turma]) {
                        summary[a.turma].used += adminTime;
                        summary[a.turma].details.admin += adminTime;
                     }
                });
                return summary;
            }, [hourBanks, visits, adminEntries]);

            // Processamento
            const processWorkbook = (wb, source = "upload") => {
                let ccCount = 0;
                let bankCount = 0;

                if (wb.SheetNames.some(name => name.toUpperCase().includes("CC"))) {
                    const sheetName = wb.SheetNames.find(name => name.toUpperCase().includes("CC"));
                    const data = XLSX.utils.sheet_to_json(wb.Sheets[sheetName]);
                    if (data.length > 0) {
                        const mappedCC = data.map((row, idx) => ({
                            id: idx,
                            codigo: row['Centro de Custo'] || row['Codigo'] || 'N/A',
                            turma: row['Turma'] || row['Nome Turma'] || 'N/A',
                            descricao: row['Descrição'] || ''
                        }));
                        setCostCenters(mappedCC);
                        ccCount = mappedCC.length;
                    }
                }

                if (wb.SheetNames.some(name => name.toUpperCase().includes("HORA"))) {
                    const sheetName = wb.SheetNames.find(name => name.toUpperCase().includes("HORA"));
                    const data = XLSX.utils.sheet_to_json(wb.Sheets[sheetName]);
                    if (data.length > 0) {
                        const mappedBanks = data.map((row, idx) => ({
                            id: idx,
                            turma: row['Turma'] || row['Nome Turma'] || 'N/A',
                            totalHoras: Number(row['Total Horas'] || row['Horas'] || 0)
                        }));
                        setHourBanks(mappedBanks);
                        bankCount = mappedBanks.length;
                    }
                }

                if (source === "github") {
                    console.log(`GitHub Auto-load: ${ccCount} CCs e ${bankCount} Bancos carregados.`);
                } else {
                    alert(`Dados processados!\n- ${ccCount} Centros de Custo\n- ${bankCount} Bancos de Horas`);
                }
            };

            const fetchFromGithub = async (urlToFetch) => {
                if (!urlToFetch) return;
                setIsLoadingGithub(true);
                try {
                    const response = await fetch(urlToFetch);
                    if (!response.ok) throw new Error("Falha ao baixar arquivo");
                    const arrayBuffer = await response.arrayBuffer();
                    const wb = XLSX.read(arrayBuffer, { type: 'array' });
                    processWorkbook(wb, "github");
                    localStorage.setItem('rateio_github_url', urlToFetch);
                } catch (error) {
                    console.error("Erro GitHub:", error);
                    alert("Erro ao carregar do GitHub. Verifique se o link é o 'Raw'.");
                } finally {
                    setIsLoadingGithub(false);
                }
            };

            const handleConfigUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (evt) => {
                    const wb = XLSX.read(evt.target.result, { type: 'binary' });
                    processWorkbook(wb);
                };
                reader.readAsBinaryString(file);
            };

            const handleDataUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (evt) => {
                    const wb = XLSX.read(evt.target.result, { type: 'binary' });
                    let msg = "Lançamentos importados!\n";
                    if (wb.SheetNames.some(name => name.toUpperCase().includes("VISITA"))) {
                        const sheet = wb.Sheets[wb.SheetNames.find(n => n.toUpperCase().includes("VISITA"))];
                        const data = XLSX.utils.sheet_to_json(sheet);
                        const mapped = data.map((row, idx) => ({
                            id: Date.now() + idx,
                            data: row['Data'] || '', turma: row['Turma'] || '',
                            cidadeOrigem: row['Origem'] || '', cidadeDestino: row['Destino'] || '',
                            horarioSaida: row['Saída'] || '', horarioChegada: row['Chegada'] || '',
                            horarioInicioVisita: row['Início Visita'] || '', horarioFimVisita: row['Fim Visita'] || '',
                            supervisor: row['Supervisor'] || ''
                        }));
                        setVisits(prev => [...prev, ...mapped]);
                        msg += `- ${mapped.length} Visitas\n`;
                    }
                    if (wb.SheetNames.some(name => name.toUpperCase().includes("ADMIN"))) {
                        const sheet = wb.Sheets[wb.SheetNames.find(n => n.toUpperCase().includes("ADMIN"))];
                        const data = XLSX.utils.sheet_to_json(sheet);
                        const mapped = data.map((row, idx) => ({
                            id: Date.now() + idx + 1000,
                            data: row['Data'] || '', turma: row['Turma'] || '',
                            atividade: row['Atividade'] || '',
                            inicio: row['Início'] || '', fim: row['Fim'] || '',
                            supervisor: row['Supervisor'] || ''
                        }));
                        setAdminEntries(prev => [...prev, ...mapped]);
                        msg += `- ${mapped.length} Admin\n`;
                    }
                    alert(msg);
                };
                reader.readAsBinaryString(file);
            };

            const addVisit = () => {
                if (!newVisit.turma || !newVisit.data) return alert("Preencha os dados obrigatórios");
                setVisits([...visits, { ...newVisit, id: Date.now() }]);
                setNewVisit({ ...newVisit, horarioSaida: '', horarioChegada: '', horarioInicioVisita: '', horarioFimVisita: '' });
            };

            const addAdmin = () => {
                if (!newAdmin.turma || !newAdmin.data) return alert("Preencha os dados obrigatórios");
                setAdminEntries([...adminEntries, { ...newAdmin, id: Date.now() }]);
                setNewAdmin({ ...newAdmin, inicio: '', fim: '' });
            };

            const exportToExcel = () => {
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(costCenters), "CC");
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(hourBanks), "CONTROLE DE HORAS");
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(visits), "RATEIO - VISITAS");
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(adminEntries), "RATEIO - ADMINISTRATIVO");
                XLSX.writeFile(wb, "Backup_Sistema_Rateio.xlsx");
            };

            const handleSendEmail = (turma) => {
                const stats = consumptionByClass[turma] || { total: 0, used: 0 };
                const saldo = stats.total - stats.used;
                const turmaVisits = visits.filter(v => v.turma === turma);
                const turmaAdmin = adminEntries.filter(a => a.turma === turma);

                const subject = encodeURIComponent(`Relatório de Rateio - ${turma}`);
                let bodyText = `Olá,\n\nResumo para a turma: ${turma}\n\n`;
                bodyText += `Contratado: ${formatHours(stats.total)}h\nConsumido: ${formatHours(stats.used)}h\nSaldo: ${formatHours(saldo)}h\n\n`;
                bodyText += `VISITAS:\n`;
                if (turmaVisits.length === 0) bodyText += "Nenhuma.\n";
                turmaVisits.forEach(v => {
                    const dur = calculateDuration(v.horarioSaida, v.horarioChegada) + calculateDuration(v.horarioInicioVisita, v.horarioFimVisita);
                    bodyText += `- ${v.data}: ${v.cidadeOrigem}->${v.cidadeDestino} (${formatHours(dur)}h) Sup:${v.supervisor}\n`;
                });
                bodyText += `\nADMIN:\n`;
                if (turmaAdmin.length === 0) bodyText += "Nenhum.\n";
                turmaAdmin.forEach(a => {
                    const dur = calculateDuration(a.inicio, a.fim);
                    bodyText += `- ${a.data}: ${a.atividade} (${formatHours(dur)}h) Sup:${a.supervisor}\n`;
                });
                window.location.href = `mailto:?subject=${subject}&body=${encodeURIComponent(bodyText)}`;
            };

            return (
                <div className="min-h-screen bg-gray-50 p-4 md:p-8 font-sans text-gray-800">
                    <div className="max-w-6xl mx-auto mb-6">
                        <div className="flex flex-col md:flex-row justify-between items-center gap-4 mb-4">
                            <div><h1 className="text-2xl font-bold text-gray-900">Sistema de Rateio</h1><p className="text-gray-500 text-sm">Controle de Horas</p></div>
                            <div className="flex gap-2">
                                <button onClick={() => setShowConfig(!showConfig)} className="bg-gray-200 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-300 flex items-center gap-2"><Settings size={18} /> {showConfig ? 'Fechar' : 'Base'}</button>
                                <button onClick={exportToExcel} className="bg-green-700 text-white px-4 py-2 rounded-lg shadow hover:bg-green-800 flex items-center gap-2"><Download size={18} /> Salvar</button>
                            </div>
                        </div>

                        {showConfig && (
                            <Card className="mb-6 bg-slate-50 border-slate-200">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <div>
                                        <h4 className="font-bold text-gray-800 mb-2 flex items-center gap-2"><Github size={18}/> GitHub Raw URL</h4>
                                        <div className="flex gap-2">
                                            <input type="text" placeholder="Cole o link Raw do Excel aqui..." className="flex-1 p-2 border rounded text-sm" value={githubUrl} onChange={(e) => setGithubUrl(e.target.value)} />
                                            <button onClick={() => fetchFromGithub(githubUrl)} className="bg-black text-white px-3 py-2 rounded hover:bg-gray-800 text-sm" disabled={isLoadingGithub}>{isLoadingGithub ? '...' : 'OK'}</button>
                                        </div>
                                    </div>
                                    <div className="border-l pl-6 border-gray-200">
                                        <h4 className="font-bold text-gray-800 mb-2 flex items-center gap-2"><FileSpreadsheet size={18}/> Upload Manual</h4>
                                        <div className="grid grid-cols-2 gap-2">
                                            <div className="relative"><input type="file" accept=".xlsx" onChange={handleConfigUpload} className="absolute inset-0 w-full opacity-0 cursor-pointer" /><button className="w-full bg-blue-100 text-blue-700 py-2 rounded text-xs font-bold hover:bg-blue-200">Base (CC)</button></div>
                                            <div className="relative"><input type="file" accept=".xlsx" onChange={handleDataUpload} className="absolute inset-0 w-full opacity-0 cursor-pointer" /><button className="w-full bg-green-100 text-green-700 py-2 rounded text-xs font-bold hover:bg-green-200">Histórico</button></div>
                                        </div>
                                    </div>
                                </div>
                            </Card>
                        )}
                    </div>

                    <div className="max-w-6xl mx-auto bg-white rounded-lg shadow-sm p-1 mb-6 flex overflow-x-auto">
                        {[{ id: 'controle', icon: BarChart3, label: 'Geral' }, { id: 'visitas', icon: Car, label: 'Visitas' }, { id: 'admin', icon: Users, label: 'Admin' }, { id: 'cc', icon: Database, label: 'CCs' }].map(tab => (
                            <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`flex-1 flex items-center justify-center gap-2 py-3 px-4 rounded-md transition-all whitespace-nowrap ${activeTab === tab.id ? 'bg-blue-50 text-blue-600 font-bold shadow-sm' : 'text-gray-500 hover:bg-gray-50'}`}>
                                <tab.icon size={18} /> {tab.label}
                            </button>
                        ))}
                    </div>

                    <div className="max-w-6xl mx-auto">
                        {activeTab === 'controle' && (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {hourBanks.length === 0 && <div className="p-4 bg-yellow-50 text-yellow-800 rounded">Base de dados vazia. Configure acima.</div>}
                                {hourBanks.map(bank => {
                                    const stats = consumptionByClass[bank.turma] || { used: 0, total: bank.totalHoras };
                                    const percentage = bank.totalHoras > 0 ? Math.min((stats.used / bank.totalHoras) * 100, 100) : 0;
                                    const saldo = bank.totalHoras - stats.used;
                                    return (
                                        <Card key={bank.id} className="border-l-4 border-l-blue-500">
                                            <div className="flex justify-between items-start mb-2">
                                                <div><h3 className="font-bold text-lg">{bank.turma}</h3><p className="text-sm text-gray-500">{formatHours(bank.totalHoras)}h</p></div>
                                                <button onClick={() => handleSendEmail(bank.turma)} className="p-2 rounded-full bg-gray-100 hover:bg-blue-100"><Mail size={18} /></button>
                                            </div>
                                            <div className="w-full bg-gray-200 rounded-full h-2.5 mt-2"><div className={`h-2.5 rounded-full ${saldo < 0 ? 'bg-red-500' : 'bg-blue-600'}`} style={{ width: `${percentage}%` }}></div></div>
                                            <div className="flex justify-between text-sm mt-1"><span>Usado: {formatHours(stats.used)}h</span><span className={saldo < 0 ? 'text-red-500 font-bold' : 'text-green-600 font-bold'}>Saldo: {formatHours(saldo)}h</span></div>
                                        </Card>
                                    );
                                })}
                            </div>
                        )}
                        {activeTab === 'visitas' && (
                            <div className="space-y-6">
                                <Card>
                                    <h3 className="font-bold text-lg mb-4 flex items-center gap-2"><Car className="text-blue-600"/> Nova Visita</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                                        <input type="date" className="p-2 border rounded" value={newVisit.data} onChange={e => setNewVisit({...newVisit, data: e.target.value})} />
                                        <select className="p-2 border rounded" value={newVisit.turma} onChange={e => setNewVisit({...newVisit, turma: e.target.value})}><option value="">Turma...</option>{costCenters.map(cc => <option key={cc.id} value={cc.turma}>{cc.turma}</option>)}</select>
                                        <input type="text" placeholder="Origem" className="p-2 border rounded" value={newVisit.cidadeOrigem} onChange={e => setNewVisit({...newVisit, cidadeOrigem: e.target.value})} />
                                        <input type="text" placeholder="Destino" className="p-2 border rounded" value={newVisit.cidadeDestino} onChange={e => setNewVisit({...newVisit, cidadeDestino: e.target.value})} />
                                    </div>
                                    <div className="grid grid-cols-4 gap-4 mb-4">
                                        <input type="time" title="Saída" className="p-2 border rounded" value={newVisit.horarioSaida} onChange={e => setNewVisit({...newVisit, horarioSaida: e.target.value})} />
                                        <input type="time" title="Chegada" className="p-2 border rounded" value={newVisit.horarioChegada} onChange={e => setNewVisit({...newVisit, horarioChegada: e.target.value})} />
                                        <input type="time" title="Início Visita" className="p-2 border rounded" value={newVisit.horarioInicioVisita} onChange={e => setNewVisit({...newVisit, horarioInicioVisita: e.target.value})} />
                                        <input type="time" title="Fim Visita" className="p-2 border rounded" value={newVisit.horarioFimVisita} onChange={e => setNewVisit({...newVisit, horarioFimVisita: e.target.value})} />
                                    </div>
                                    <input type="text" placeholder="Supervisor" className="p-2 border rounded w-full mb-4" value={newVisit.supervisor} onChange={e => setNewVisit({...newVisit, supervisor: e.target.value})} />
                                    <button onClick={addVisit} className="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 flex justify-center items-center gap-2"><Save size={18} /> Salvar</button>
                                </Card>
                                <Card>
                                    <table className="w-full text-sm text-left"><thead className="bg-gray-100"><tr><th className="p-2">Data</th><th className="p-2">Rota</th><th className="p-2">Total</th><th className="p-2">Del</th></tr></thead>
                                    <tbody>{visits.map(v => {
                                        const total = calculateDuration(v.horarioSaida, v.horarioChegada) + calculateDuration(v.horarioInicioVisita, v.horarioFimVisita);
                                        return <tr key={v.id} className="border-b"><td className="p-2">{v.data}</td><td className="p-2">{v.cidadeOrigem}→{v.cidadeDestino}</td><td className="p-2 font-bold">{formatHours(total)}</td><td className="p-2"><button onClick={() => setVisits(visits.filter(i => i.id !== v.id))} className="text-red-500"><Trash2 size={16} /></button></td></tr>
                                    })}</tbody></table>
                                </Card>
                            </div>
                        )}
                        {activeTab === 'admin' && (
                            <div className="space-y-6">
                                <Card>
                                    <h3 className="font-bold text-lg mb-4 flex items-center gap-2"><Users className="text-purple-600"/> Admin</h3>
                                    <div className="grid grid-cols-1 gap-4 mb-4">
                                        <input type="date" className="p-2 border rounded" value={newAdmin.data} onChange={e => setNewAdmin({...newAdmin, data: e.target.value})} />
                                        <select className="p-2 border rounded" value={newAdmin.turma} onChange={e => setNewAdmin({...newAdmin, turma: e.target.value})}><option value="">Turma...</option>{costCenters.map(cc => <option key={cc.id} value={cc.turma}>{cc.turma}</option>)}</select>
                                        <input type="text" placeholder="Atividade" className="p-2 border rounded" value={newAdmin.atividade} onChange={e => setNewAdmin({...newAdmin, atividade: e.target.value})} />
                                        <div className="flex gap-4"><input type="time" className="p-2 border rounded flex-1" value={newAdmin.inicio} onChange={e => setNewAdmin({...newAdmin, inicio: e.target.value})} /><input type="time" className="p-2 border rounded flex-1" value={newAdmin.fim} onChange={e => setNewAdmin({...newAdmin, fim: e.target.value})} /></div>
                                    </div>
                                    <button onClick={addAdmin} className="w-full bg-purple-600 text-white py-2 rounded hover:bg-purple-700 flex justify-center items-center gap-2"><Save size={18} /> Salvar</button>
                                </Card>
                                <Card>
                                    <table className="w-full text-sm text-left"><thead className="bg-gray-100"><tr><th className="p-2">Data</th><th className="p-2">Ativ.</th><th className="p-2">Total</th><th className="p-2">Del</th></tr></thead>
                                    <tbody>{adminEntries.map(a => <tr key={a.id} className="border-b"><td className="p-2">{a.data}</td><td className="p-2">{a.atividade}</td><td className="p-2 font-bold">{formatHours(calculateDuration(a.inicio, a.fim))}</td><td className="p-2"><button onClick={() => setAdminEntries(adminEntries.filter(i => i.id !== a.id))} className="text-red-500"><Trash2 size={16} /></button></td></tr>)}</tbody></table>
                                </Card>
                            </div>
                        )}
                        {activeTab === 'cc' && (
                            <Card>
                                <h3 className="font-bold text-lg mb-4">Centros de Custo</h3>
                                <table className="w-full text-left border-collapse">
                                    <thead><tr className="bg-gray-100"><th className="p-3 border-b">CC</th><th className="p-3 border-b">Turma</th></tr></thead>
                                    <tbody>{costCenters.map(cc => <tr key={cc.id} className="border-b"><td className="p-3 font-mono text-blue-600 font-bold">{cc.codigo}</td><td className="p-3">{cc.turma}</td></tr>)}</tbody>
                                </table>
                            </Card>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
